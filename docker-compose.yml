version: "3"
services:

  webapp:
    build: webapp/
    restart: always
    ports:
      - "80:80"
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  mqtt-broker:
    build: mqtt-broker/
    restart: always
    ports:
      - "1883:1883"
      - "3000:3000"
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  streamer-forward:
    build: streamer/
    restart: always
    environment:
      - LOCATION=forward
      - CAMERAURI=http://192.168.1.222:8081/bmimg
      - WSPORT=8100
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  streamer-down:
    build: streamer/
    restart: always
    environment:
      - LOCATION=down
      - CAMERAURI=http://192.168.2.218:8081/bmimg
      - WSPORT=8101
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  camera-config-forward:
    build: camera-config/
    restart: always
    environment:
      - LOCATION=forward
      - CAMERAIP=192.168.1.222
      - RESOLUTION=2
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  camera-config-down:
    build: camera-config/
    restart: always
    environment:
      - LOCATION=down
      - CAMERAIP=192.168.2.218
      - RESOLUTION=2
      - FLIPH=1
      - FLIPV=1
    logging:
      options:
        max-size: "1000k"
        max-file: "10"
  openrov:
    #image: scini/openrov:build-20181202
    build: openrov/
    restart: always
    command: 192.168.2.215
    cap_add:
      - SYS_NICE
    volumes:
      - "./assets/www:/opt/openrov/www"
      - "./assets/www-ro:/opt/openrov/www-ro"
      - "./assets/copilot:/opt/openrov/copilot"
      - "./assets/mqttConfig.json:/opt/openrov/config/mqttConfig.json"
      - "./assets/adjustments.prod.json:/opt/openrov/cockpit/src/lib/adjustments.json"
      - "./assets/rovconfig.json:/tmp/rovconfig.json"
    logging:
      options:
        max-size: "1000k"
        max-file: "10"

  file-browser:
    image: coderaiser/cloudcmd
    restart: always
    environment:
      - PORT=8000
      - CLOUDCMD_ROOT=/srv/scini
    volumes:
      - "./assets:/srv/scini/assets:rw"
    logging:
      options:
        max-size: "500k"
        max-file: "10"

  logger:
    build: logger/
    restart: always
    logging:
      options:
        max-size: "500k"
        max-file: "10"
    expose:
      - "514"

  audio:
    build: audio/
